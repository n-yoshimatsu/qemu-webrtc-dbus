# Qt-based OpenGL実装の実行可能性評価

**Date**: 2026-01-22  
**Status**: 環境制限の発見  

## 調査結果

### 環境情報
- Mesa: 25.0.7（DMA-BUF対応バージョン）
- GPU: Intel UHD Graphics 630
- OpenGL: 4.6対応
- EGL: インストール済み（但しeglCreateImageKHRシンボル不在）

### 問題点
1. **ヘッドレス環境での制限**
   - `QT_QPA_PLATFORM=offscreen`使用時、libEGL.so.1がDMA-BUF拡張関数を公開していない
   - GBMコンテキストが適切に初期化されていない可能性

2. **代替アプローチの必要性**
   - Qt-based OpenGL + DMA-BUFのフルサポートは、このシステムでは困難
   - gl=offモード（既に動作）の継続使用が現実的

## 推奨アクション

### オプション1: gl=offモード継続（推奨）
**メリット**:
- 既に完全に動作（8.6ms/frame）
- 実装不要
- 安定性が高い

**デメリット**:
- CPU処理なので、高負荷時に遅延増加可能
- フレームレートは10fps程度に制限

### オプション2: Cython/C拡張の検討
**メリット**:
- 低レベルアクセスでDMA-BUF処理可能
- パフォーマンス向上（<5ms/frame目指せる）

**デメリット**:
- 開発期間が長い（1-2週間）
- メンテナンスが複雑
- デバッグが困難

### オプション3: Vulkanへの移行
**メリット**:
- 最新GPU APIで確実なDMA-BUF対応
- 将来性がある

**デメリット**:
- 大規模なコード書き換え
- 学習曲線が急

## 結論

**現在の推奨**: gl=offモード継続利用  
- WebRTC配信の基本的なニーズは満たされている
- DMA-BUF処理は、QEMU側（gl=onモード）とクライアント側（OpenGL）の組み合わせの複雑性が高い
- gl=offモードでの安定運用が最優先

---

**Next Step**: ユーザーと協議し、引き続きgl=offを使用するか、または別の実装方法を検討するかを決定
